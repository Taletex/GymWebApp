<ng-template #trainingModal let-modal>
    <div class="trainingmodal__container">
        <div class="modal-header">
            <h4 class="modal-title h4" id="modal-basic-title">Crea Allenamento</h4>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="card h-100">
                <div class="card-body">
                    <form id="trainingForm" ngNativeValidate action='#' #trainingForm="ngForm" (ngSubmit)="modal.close(newTraining)" class="form-row m-0">
                        <div class="col-12 form-group">Allenamento creato da {{newTraining.author.name}} {{newTraining.author.surname}} il {{newTraining.creationDate | date:'dd/MM/yyyy'}}</div>
                        <div class="col-12 col-md-4 form-group">
                            <label for="newTrainingType"
                                class="col-form-label col-form-label-sm text-muted">Disciplina</label>
                            <select [(ngModel)]="newTraining.type" class="form-control form-control-sm cursor-pointer" id="newTraining" name="newTraining"
                                *ngIf="(newTraining.type==TRAINING_TYPES.POWERLIFTING || newTraining.type==TRAINING_TYPES.WEIGHTLIFTING || newTraining.type==TRAINING_TYPES.CROSSFIT || newTraining.type==TRAINING_TYPES.BODYBUILDING || newTraining.type==TRAINING_TYPES.SALA)">
                                <option *ngFor="let type of TRAINING_TYPES | keyvalue" [value]="type.value" class="text-capitalize">{{type.value}}</option>
                            </select>
                            <div class="position-relative" *ngIf="!(newTraining.type==TRAINING_TYPES.POWERLIFTING || newTraining.type==TRAINING_TYPES.WEIGHTLIFTING || newTraining.type==TRAINING_TYPES.CROSSFIT || newTraining.type==TRAINING_TYPES.BODYBUILDING || newTraining.type==TRAINING_TYPES.SALA)">
                                <input type="text" [(ngModel)]="newTraining.type" class="form-control form-control-sm" id="newTraining" name="newTraining">
                                <div (click)="newTraining.type=TRAINING_TYPES.POWERLIFTING" style="position:absolute; right: 3px; top: 0px;">&times;</div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 form-group">
                            <label for="newTrainingStartDate" class="col-form-label col-form-label-sm text-muted">Data inizio</label>
                            <input type="datetime-local" [ngModel]="newTraining.startDate | date:'yyyy-MM-ddTHH:mm'" [max]="TRAINING_VALIDATIONS.MAX_DATE" 
                                (ngModelChange)="newTraining.startDate = $event" class="form-control form-control-sm" [ngClass]="{'border-danger': !isValidStartDate(newTraining.startDate)}"
                                id="newTrainingStartDate" name="newTrainingStartDate">
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 form-group">
                            <label for="newTrainingEndDate" class="col-form-label col-form-label-sm text-muted">Data fine</label>
                            <input type="datetime-local" [ngModel]="newTraining.endDate | date:'yyyy-MM-ddTHH:mm'" [min]="newTraining.startDate | date:'yyyy-MM-ddTHH:mm'" [max]="TRAINING_VALIDATIONS.MAX_DATE" 
                                (ngModelChange)="newTraining.endDate = $event" class="form-control form-control-sm" [ngClass]="{'border-danger': !isValidEndDate(newTraining.startDate, newTraining.endDate)}"
                                id="newTrainingEndDate" name="newTrainingEndDate">
                        </div>
                        <div class="col-12 form-group">
                            <label for="newTrainingAthletes"
                                class="col-form-label col-form-label-sm text-muted">Atleti</label>
                            <ng-multiselect-dropdown 
                                class="w-100 small" 
                                name="newTrainingAthletes" 
                                ngDefaultControl
                                [placeholder]="'Atleti'" 
                                [settings]="dropdownSettings" 
                                [data]="athleteList"
                                [(ngModel)]="newTraining.athletes" 
                                (onSelect)="onItemSelect($event)"
                                (onSelectAll)="onSelectAll($event)"
                                required
                                [ngClass]="{'is-invalid-dropdown': !newTraining.athletes || !newTraining.athletes.length}"
                                ngbTooltip="Deve essere selezionato almeno un atleta"
                                [disableTooltip]="newTraining.athletes && newTraining.athletes.length">
                                <ng-template #optionsTemplate let-item let-option="option" let-id="id" let-isSelected="isSelected">
                                    <div>
                                        <label style="color: #333; min-width: 130px; font-weight: normal;" class="m-0"
                                            [ngStyle]="{ 'font-weight': isSelected? 'bold':' normal','color': getItems[id].isDisabled? 'lightgrey': ''}">{{getItems[id].name}} {{getItems[id].surname}} ({{getItems[id].dateOfBirth | date:'dd/MM/yyyy'}})</label>
                                    </div>
                                </ng-template>
                                <ng-template #optionSelectedTemplate let-option="option" let-id="id">
                                    <div>
                                        {{getItems[id].name}} {{getItems[id].surname}} ({{getItems[id].dateOfBirth | date:'dd/MM/yyyy'}})
                                    </div>
                                </ng-template>
                            </ng-multiselect-dropdown>
                        </div>
                        <div class="col-12 form-group">
                            <label for="newTrainingcomment"
                                class="col-form-label col-form-label-sm text-muted">Commento</label>
                            <textarea [(ngModel)]="newTraining.comment" class="form-control" [maxlength]="TRAINING_VALIDATIONS.MAX_TRAINING_COMMENT_LENGTH" 
                                id="newTrainingcomment" name="newTrainingcomment" placeholder="Commento..." [ngClass]="{'is-invalid': newTraining.comment.length > TRAINING_VALIDATIONS.MAX_TRAINING_COMMENT_LENGTH}"></textarea>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <div class="position-relative">
                <button type="submit" (click)="trainingForm.submit()" ngbAutofocus class="btn btn-success" [ngClass]="{'disabled header-invalid cursor-not-allowed': !areBasicTrainingInfosValidToSubmit(newTraining)}" 
                ngbTooltip="Alcuni input presentano valori errati" [disableTooltip]="areBasicTrainingInfosValidToSubmit(newTraining)">CREA</button>
            </div>
        </div>
    </div>
</ng-template>

<div (click)="openTrainingModal(trainingModal)">
    <ng-content></ng-content>
</div>