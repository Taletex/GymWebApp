<div class="main__profile-details row m-3">

    <div class="profile-details__maincontainer col-12 card p-0">

        <div class="maincontainer__header card-header">

            <div class="d-flex align-items-baseline mb-2">
                <h1 class="m-0">{{account.user.name}} {{account.user.surname}}</h1>
                <div class="d-flex input-group w-auto ml-auto">
                    <div class="input-group-prepend"><span class="input-group-text">ACTIONS</span></div>
                    <div class="d-flex align-items-center form-control">
                        <div (click)="changeMode(PAGEMODE.READONLY)" class="inverse-image-button"
                            [ngClass]="{'active': pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY}"
                            ngbTooltip="Visualizza" placement="left"><img src="assets/icons/actions/visibility.svg"
                                style="width:20px; height:auto;"></div>
                        <div (click)="changeMode(PAGEMODE.WRITE)" class="ml-2 inverse-image-button"
                            [ngClass]="{'active': pageStatus[PAGES.PROFILES] == PAGEMODE.WRITE}" ngbTooltip="Modifica"
                            placement="left"><img src="assets/icons/actions/edit.svg" style="width:20px; height:auto;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="maincontainer__body card-body pt-3">

            <!-- USER INFORMATIONS -->
            <div class="row m-0 p-0">
                <div class="col-12 p-0">
                    <button class="btn btn-outline-dark w-100" type="button" data-toggle="collapse"
                        data-target="#userInformationContainer" aria-expanded="true"
                        aria-controls="userInformationContainer">
                        <h5 class="m-0">Informazioni Utente</h5>
                    </button>
                </div>
                <div class="col-12 form-row p-3 border round-5 m-0 mt-2 collapse show " id="userInformationContainer">
                    <form [formGroup]="userForm" (ngSubmit)="onSubmitUser()" class="col-12 row m-0 p-0">
                        <fieldset class="col-12 row form-group m-0 p-0" [disabled]="(pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)">
                            <div class="row col-12 m-0 p-0">
                                <!-- Name -->
                                <div class="col-3 form-group">
                                    <label for="userName" class="col-form-label col-form-label-sm text-muted">Nome</label>
                                    <input type="text" formControlName="name" required class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.name.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                    <div *ngIf="userFormSubmitted && fu.name.errors" class="invalid-feedback">
                                        <div *ngIf="fu.name.errors.required">Nome obbligatorio</div>
                                    </div>
                                </div>

                                <!-- Surname -->
                                <div class="col-3 form-group">
                                    <label for="userSurname" class="col-form-label col-form-label-sm text-muted">Cognome</label>
                                    <input type="text" formControlName="surname" required class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.surname.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                    <div *ngIf="userFormSubmitted && fu.surname.errors" class="invalid-feedback">
                                        <div *ngIf="fu.surname.errors.required">Cognome obbligatorio</div>
                                    </div>
                                </div>

                                <!-- Date of Birth -->
                                <div class="col-3 form-group">
                                    <label for="userDoB" class="col-form-label col-form-label-sm text-muted">Data di nascita</label>
                                    <input type="date" formControlName="dateOfBirth" min="01-01-1900" max="{{today}}" class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.dateOfBirth.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                </div>

                                <!-- User Sex -->
                                <div class="col-3 form-group">
                                    <label for="userSex" class="col-form-label col-form-label-sm text-muted">Sesso</label>
                                    <select formControlName="sex" class="form-control form-control-sm" 
                                        [ngClass]="{'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY), 'cursor-pointer': (pageStatus[PAGES.PROFILES] == PAGEMODE.WRITE), 'is-invalid': userFormSubmitted && fu.sex.errors}">
                                        <option [value]="'M'">Uomo</option>
                                        <option [value]="'F'">Donna</option>
                                    </select>
                                </div>

                                <!-- User Type -->
                                <div class="col-4 form-group">
                                    <label for="userType" class="col-form-label col-form-label-sm text-muted">Tipo</label>
                                    <select formControlName="userType" required class="form-control form-control-sm cursor-pointer"
                                        [ngClass]="{'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY), 'cursor-pointer': (pageStatus[PAGES.PROFILES] == PAGEMODE.WRITE), 'is-invalid': userFormSubmitted && fu.userType.errors}">
                                        <option [value]="'athlete'">Atleta</option>
                                        <option [value]="'coach'">Coach</option>
                                        <option [value]="'both'">Both</option>
                                    </select>
                                    <div *ngIf="userFormSubmitted && fu.userType.errors" class="invalid-feedback">
                                        <div *ngIf="fu.userType.errors.required">Tipo utente obbligatorio</div>
                                    </div>
                                </div>

                                <!-- Body Weight -->
                                <div class="col-4 form-group">
                                    <label for="userBw" class="col-form-label col-form-label-sm text-muted">Body Weight</label>
                                    <input type="number" min=10 max=500 formControlName="bodyWeight" class="form-control form-control-sm"
                                        [ngClass]="{'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY), 'is-invalid': userFormSubmitted && fu.bodyWeight.errors}">
                                </div>

                                <!-- Years of experience -->
                                <div class="col-4 form-group">
                                    <label for="userYearsOfExperience" class="col-form-label col-form-label-sm text-muted">Esperienza (anni)</label>
                                    <input type="number" min=0 max=100 formControlName="yearsOfExperience" class="form-control form-control-sm"
                                        [ngClass]="{'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY), 'is-invalid': userFormSubmitted && fu.yearsOfExperience.errors }">
                                </div>

                                <!-- Email  -->
                                <div class="col-6 form-group">
                                    <label for="userContactsEmail" class="col-form-label col-form-label-sm text-muted">Email</label>
                                    <input type="email" formControlName="userEmail" required class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.userEmail.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                    <div *ngIf="userFormSubmitted && fu.userEmail.errors" class="invalid-feedback">
                                        <div *ngIf="fu.userEmail.errors.email">Il campo email deve contenere un'email valida</div>
                                    </div>
                                </div>

                                <!-- Telephone -->
                                <div class="col-6 form-group">
                                    <label for="userContactsTelephone"
                                        class="col-form-label col-form-label-sm text-muted">Telefono</label>
                                    <input type="tel" formControlName="telephone" class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.telephone.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                </div>

                                <!-- Residence State -->
                                <div class="col-4 form-group">
                                    <label for="userResidenceState" class="col-form-label col-form-label-sm text-muted">Stato</label>
                                    <input type="text" formControlName="residenceState" class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.residenceState.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                </div>

                                <!-- Residence City -->
                                <div class="col-4 form-group">
                                    <label for="userResidenceCity" class="col-form-label col-form-label-sm text-muted">Città</label>
                                    <input type="text" formControlName="residenceCity" class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.residenceCity.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                </div>

                                <!-- Residence Address -->
                                <div class="col-4 form-group">
                                    <label for="userResidenceAddress" class="col-form-label col-form-label-sm text-muted">Indirizzo</label>
                                    <input type="text" formControlName="residenceAddress" class="form-control form-control-sm"
                                        [ngClass]="{'is-invalid': userFormSubmitted && fu.residenceAddress.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)}"/>
                                </div>

                                <div class="form-group col-12 d-flex" *ngIf="(pageStatus[PAGES.PROFILES] == PAGEMODE.WRITE)">
                                    <button type="submit" class="btn btn-primary ml-auto"><span *ngIf="bLoading" class="spinner-border spinner-border-sm mr-1"></span> Aggiorna</button>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>

            <!-- ACCOUNT INFORMATIONS -->
            <div class="row m-0 p-0 mt-3">
                <div class="col-12 p-0">
                    <button class="btn btn-outline-dark w-100" type="button" data-toggle="collapse" data-target="#accountInformationContainer" aria-expanded="false" aria-controls="accountInformationContainer">
                        <h5 class="m-0">Informazioni Account</h5>
                    </button>
                </div>
                <div class="col-12 form-row p-3 border round-5 m-0 mt-2 collapse" id="accountInformationContainer">
                    <form [formGroup]="accountForm" (ngSubmit)="onSubmitAccount()" class="col-12 row m-0 p-0">
                        <fieldset class="col-12 row m-0 p-0" [disabled]="(pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY)">
                            <div class="row col-12 m-0 p-0">
                                <div class="form-group col-12">
                                    <label class="col-form-label col-form-label-sm text-muted">Email</label>
                                    <input type="text" formControlName="email" class="form-control form-control-sm"
                                        [ngClass]="{ 'is-invalid': accountFormSubmitted && fa.email.errors, 'border-bottom-only bg-white': (pageStatus[PAGES.PROFILES] == PAGEMODE.READONLY) }"
                                        />
                                    <div *ngIf="accountFormSubmitted && fa.email.errors" class="invalid-feedback">
                                        <div *ngIf="fa.email.errors.required">Email obbligatoria</div>
                                        <div *ngIf="fa.email.errors.email">Il campo email deve contenere un'email valida</div>
                                    </div>
                                </div>
                                <div *ngIf="pageStatus[PAGES.PROFILES] == PAGEMODE.WRITE" class="col-12">
                                    <div class="form-row">
                                        <div class="form-group col">
                                            <label class="col-form-label col-form-label-sm text-muted">Password (lasciare vuoto
                                                il campo per mantenere la stessa password)</label>
                                            <input type="password" formControlName="password"
                                                class="form-control form-control-sm"
                                                [ngClass]="{ 'is-invalid': accountFormSubmitted && fa.password.errors }" />
                                            <div *ngIf="accountFormSubmitted && fa.password.errors" class="invalid-feedback">
                                                <div *ngIf="fa.password.errors.required">Password obbligatoria</div>
                                                <div *ngIf="fa.password.errors.minlength">Il campo password deve essere di almeno 6 caratteri</div>
                                            </div>
                                        </div>
                                        <div class="form-group col">
                                            <label class="col-form-label col-form-label-sm text-muted">Conferma Password
                                                (lasciare vuoto il campo per mantenere la stessa password)</label>
                                            <input type="password" formControlName="confirmPassword"
                                                class="form-control form-control-sm"
                                                [ngClass]="{ 'is-invalid': accountFormSubmitted && fa.confirmPassword.errors }" />
                                            <div *ngIf="accountFormSubmitted && fa.confirmPassword.errors" class="invalid-feedback">
                                                <div *ngIf="fa.confirmPassword.errors.required">Conferma Password è obbligatoria
                                                </div>
                                                <div *ngIf="fa.confirmPassword.errors.mustMatch">Le password devono essere uguali
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group d-flex">
                                        <button type="submit" class="btn btn-primary ml-auto">
                                            <span *ngIf="bLoading" class="spinner-border spinner-border-sm mr-1"></span>
                                            Aggiorna
                                        </button>
                                        <button type="button" (click)="onDeleteAccount()" class="btn btn-danger ml-2">
                                            <span *ngIf="accountFormDeleting" class="spinner-border spinner-border-sm mr-1"></span>
                                            Elimina
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>

    </div>

    <!-- Loader -->
    <div class='h-100 w-100' [hidden]="!bLoading">
        <div style="position:absolute; background-color:black; opacity:50%; right:0; top:0;" class="w-100 h-100">
            <div class="container d-flex align-items-center justify-content-center w-100 h-100">
                <div class="lds-ring">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
        </div>
    </div>

</div>